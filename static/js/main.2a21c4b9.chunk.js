(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,function(e,t,a){e.exports=a(23)},,,,,function(e,t,a){},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACQElEQVRIiZWVP2iUQRDF31sOOY5DRCSIpBAri1SWVlZa2GpISgt7axtJISJWFjaWNtrYxFYF8Q+CIgaUaKWCilwhGCRIiPOzuN1z7+67u9yDj53dnX0zO9/MrJUBtCVdk7QsqSMp5fWkCrZDzfgBXLF9z/Z//Uwi4Krty5J+SvoNRCaUpEmkxYEkacH2rqQztl+MKrUjYgP4FRFLQCsiEpDKmGVFhIpc7beAS/SxVnO38pgkJWDL9vfsyTTE6Ah8yHKnVhzE17ZsRwnNvACKU0P/rJ4kYB7CoXl16yEHS6aUA1FnwBTyfcAT4HrOPkl6DdwZNVAOdID3wCfgwCwDEdEFNoG/wF3gYOZpA0uNN5gHtlUyS9KKpAfAgu0/tt/Vuq3qQJOnRyXdlNQtOnlsSVqsnDtp+zlw3vbbMaJJIQKWmQ/fgNO1s4N20HSDslbvzZCPAPclrZS9VEKkkfxtCt1eZPXD3i49rFUUJqXnUOOaLfdsX5S0nlIaWJtILumNpIeSutUPlu1WTsd2dfYzsJpSejnGAnQjYjMi9lQHWf9jRBARAK+AxSbd0V40i3sA25G/dUlnbX/NFX680UBTxky5wQ7QA25LWrXdi4iOpFuSLowdiIgSoi97CVGTI8CpXAs36vXyHkx7ChvREM76bRmg1EGo/2ikUYU5UAyMt2tJu8CO+ul4aN7ml3Esj9tNVndsP5Z0QtJTSVv0X7byzUJpftuSHo0ZsK2IWLO9Hzhn+/AkprrqR+Se7TVJz2r9f9bS+B8jtyFhAAAAAElFTkSuQmCC"},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(8),r=a.n(o),c=a(1),l=a(2),i=a(4),u=a(3),m=a(5),g=(a(15),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).logOutHandler=function(e){e.target.classList.contains("chat-status")||a.props.logOut()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e="chat-status chat-status_".concat(this.props.chatStatus),t="Welcome to The Rolling Scopes School chat",n=this.props.user?s.a.createElement(s.a.Fragment,null,"Hello, ",s.a.createElement("span",{className:"welcome__name"},this.props.user," "),"! ",t," "):s.a.createElement(s.a.Fragment,null,t,s.a.createElement("span",{className:"welcome__login_mobile"},"RSS chat")," ");return s.a.createElement("header",{className:"header"},s.a.createElement("h2",{className:"welcome header__welcome"},n),this.props.user&&s.a.createElement("div",{onClick:this.logOutHandler,className:"logout header__logout"},s.a.createElement("span",{className:e,title:"Chat status: "+this.props.chatStatus}),"Log out",s.a.createElement("img",{className:"logout__img",src:a(16),alt:"Log Out"})))}}]),t}(n.Component)),h=(a(17),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={value:""},a.changeHandler=function(e){a.setState({value:e.target.value})},a.submitHandler=function(e){e.preventDefault(),a.state.value.replace(/ /g,"").length>0&&a.props.logIn(a.state.value)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("section",{className:"login"},s.a.createElement(g,null),s.a.createElement("form",{onSubmit:this.submitHandler,className:"login__form"},s.a.createElement("input",{type:"text",value:this.state.value,onChange:this.changeHandler,className:"login__user",placeholder:"Enter your username",maxLength:"15",autoFocus:!0,required:!0}),s.a.createElement("input",{type:"submit",value:"Start chatting!",className:"login__enter"})))}}]),t}(n.Component)),f=a(6),d=a(9),p=(a(19),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).messagesContainer=s.a.createRef(),a.updateScroll=function(){a.messagesContainer.current.scrollTop=a.messagesContainer.current.scrollHeight},a.buttonClickHandler=function(){a.props.loadMoreMessages()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"getMessages",value:function(e){return 0===e.length?[]:e.map(function(e){return s.a.createElement("div",{key:e.id,className:"message messages-container__message"},s.a.createElement("span",{className:"message__author"},e.from),s.a.createElement("span",{className:"message__date"}," ",d(e.time).format("MMM Do, h:mm a")),s.a.createElement("p",{className:"message__text"},e.message))})}},{key:"render",value:function(){var e=this.getMessages(this.props.messages),t=this.props.loadMoreButton?"load-more_active":"load-more_disabled";return s.a.createElement("div",{ref:this.messagesContainer,className:"messages-container"},s.a.createElement("button",{onClick:this.buttonClickHandler,className:"messages-container__load-more "+t},"Load more"),e)}}]),t}(n.Component)),S=(a(20),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={value:""},a.changeHandler=function(e){a.setState({value:e.target.value})},a.keyDownHandler=function(e){13===e.keyCode&&(e.preventDefault(),a.submitHandler(e))},a.submitHandler=function(e){e.preventDefault(),a.props.sendMessage(a.state.value),a.setState({value:""})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("form",{onSubmit:this.submitHandler,className:"user-message"},s.a.createElement("textarea",{value:this.state.value,onChange:this.changeHandler,onKeyDown:this.keyDownHandler,className:"user-message__textarea",rows:"2",placeholder:"Type your message ..."}),s.a.createElement("input",{type:"submit",className:"user-message__send",title:"Send"}))}}]),t}(n.Component)),b=(a(21),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={allMessages:[],lastMessages:[],loadMoreButton:null,chatStatus:"offline"},a.webSocket=null,a.autoReconnect=null,a.tabNotification=null,a.componentDidMount=function(){a.connectToChat(),"granted"!==Notification.permission&&Notification.requestPermission()},a.componentWillUnmount=function(){a.webSocket.removeEventListener("close",a.checkConnection),a.webSocket.removeEventListener("error",a.checkConnection)},a.logOut=function(){localStorage.removeItem("user"),clearInterval(a.autoReconnect),a.setState({chatStatus:"offline"}),a.webSocket.close(),a.props.logOut()},a.connectToChat=function(){a.webSocket=new WebSocket("wss://wssproxy.herokuapp.com/"),a.checkConnection(),a.webSocket.onopen=function(){a.setState({chatStatus:"online"}),a.state.allMessages.length>50&&a.setState({loadMoreButton:"active"})},a.webSocket.addEventListener("close",a.checkConnection),a.webSocket.addEventListener("error",a.checkConnection),a.webSocket.onmessage=function(e){var t=JSON.parse(e.data);0===a.state.allMessages.length&&a.setState({allMessages:t});var n=a.state.allMessages,s=0===a.state.lastMessages.length?Object(f.a)(n.slice(0,50).reverse()):[].concat(Object(f.a)(a.state.lastMessages),Object(f.a)(t));a.setState({lastMessages:s}),n.length>50&&a.setState({loadMoreButton:"active"}),a.refs.messagesContainer&&a.refs.messagesContainer.updateScroll(),document.hidden&&a.startBrowserNotification(),document.hidden&&!a.tabNotification&&a.startTabNotification()}},a.sendMessage=function(e){var t={from:a.props.user,message:e};1===a.webSocket.readyState&&a.webSocket.send(JSON.stringify(t))},a.loadMoreMessages=function(){var e=a.state.lastMessages.length,t=a.state.allMessages.length>e+50?e+50:a.state.allMessages.length,n=a.state.allMessages.slice(e,t).reverse();a.setState({lastMessages:[].concat(Object(f.a)(n),Object(f.a)(a.state.lastMessages))}),t===a.state.allMessages.length&&a.setState({loadMoreButton:null})},a.checkConnection=function(){a.autoReconnect=setInterval(function(){1===a.webSocket.readyState?clearInterval(a.autoReconnect):(a.setState({chatStatus:"offline",allMessages:[],lastMessages:[],loadMoreButton:null}),clearInterval(a.autoReconnect),a.connectToChat())},2e3)},a.startBrowserNotification=function(){"granted"===Notification.permission&&new Notification("RSS chat",{icon:"https://yt3.ggpht.com/a/AGF-l7_XBv-WdGb5TSh9COVN7GK75B2NQrzAZmdhdw=s900-c-k-c0xffffffff-no-rj-mo",body:"Hey there! You have at least 1 unread message in The Rolling Scopes School chat."})},a.startTabNotification=function(){a.tabNotification=setInterval(function(){document.title="RSS chat"===document.title?"New message!":"RSS chat",document.hidden||(clearInterval(a.tabNotification),document.title="RSS chat",a.tabNotification=null)},200)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement(g,{user:this.props.user,logOut:this.logOut,chatStatus:this.state.chatStatus}),s.a.createElement("main",{className:"chat-room"},s.a.createElement("section",{className:"chat chat-room__chat"},s.a.createElement(p,{messages:this.state.lastMessages,ref:"messagesContainer",loadMoreMessages:this.loadMoreMessages,loadMoreButton:this.state.loadMoreButton}),s.a.createElement(S,{sendMessage:this.sendMessage}))))}}]),t}(n.Component)),v=(a(22),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={user:null},a.logIn=function(e){localStorage.setItem("user",e),a.setState({user:e})},a.logOut=function(){a.setState({user:null})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,this.state.user||localStorage.getItem("user")?s.a.createElement(b,{logOut:this.logOut,user:localStorage.getItem("user")||this.state.user}):s.a.createElement(h,{logIn:this.logIn,user:this.state.user}))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(v,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[10,1,2]]]);
//# sourceMappingURL=main.2a21c4b9.chunk.js.map